
<div class='float-right'>
  <div class='btn-group pull-right' uib-dropdown
    dropdown-append-to-body ng-if='vm.view==="contracts"'>
    <button type='button' class='btn btn-sm btn-primary' uib-dropdown-toggle>
      Documents<span class='caret'></span>
    </button>
    <div class='dropdown-menu' uib-dropdown-menu role='menu'>
      <span
        ng-click="vm.setDocument(document)"
        ng-repeat='document in vm.documents'
        class='dropdown-item'>{{document.name}}</span>
    </div>
  </div>
  <div ng-if='vm.view === "documents"'ng-click="vm.view = 'contracts'" class='btn btn-sm btn-primary'>
    Contracts
  </div>
</div>
<div ng-if='vm.view === "documents"'>
  <div ng-show='vm.documents.length === 0'>No Documents</div>
  <iframe src="{{vm.selectedDocument.url | trusted}}"
          height='500'
          width='600'></iframe>
</div>
<form ng-submit="vm.save()" ng-if='vm.view === "contracts"' novalidate>
  <div class="row">
    <div class="col-8">
      <div class="form-group">
        <label class="control-label">VIN</label>
        <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.vin }" ng-model="vm.contract.vin" ng-change="vm.checkVIN()" />
        <div class="invalid-feedback">
          Please enter a VIN.
        </div>
      </div>
      <div ng-repeat="package in vm.contract.template.packages" class="package" style="background-color:#BA2026; color: white; display: inline-flex; height: 300px; margin-right: 15px;">
        <div class="package-name">{{ package.name }}</div><br>
        <div class="coverage-and-addons">
          <label
            ng-repeat="coverage in package.coverages" style="display: block;">
            <input
              type="radio"
              name="coverage"
              ng-model="vm.contract.coverage_id"
              ng-value="coverage.id" />
            <span ng-if='coverage.limit_in_miles'>
                {{ coverage.length_in_months | termInMonthsOrYears }} or {{ coverage.up_to ? ' up to  ' : '' }}{{ coverage.limit_in_miles
                | number }} miles</span>
            <span ng-if='!coverage.limit_in_miles'>
              {{ coverage.length_in_months | termInMonthsOrYears }}/unlimited mileage service
            </span>
          </label>
          <br />
          <label ng-repeat="addon in package.addons" ng-class="{ 'text-secondary': !vm.packageSelected(package) || !vm.packageAllowed(package) }" style="display: block;">
            <input type="checkbox" ng-name="package_{{ package.id }}_addon_{{ addon.id }}" checklist-model="vm.contract.addons" checklist-value="addon" /> {{ addon.name }} <span ng-if="addon.amount_in_cents">- {{ (addon.amount_in_cents / 100) | currency }}</span>
          </label>
        </div>
        <div class="clearfix"></div>
        <hr />
      </div>
      <div class="form-group row">
        <div class="col">
          <label class="control-label">Year</label>
          <div class="form-control-static">{{ vm.contract.year }}</div>
        </div>
        <div class="col">
          <label class="control-label">Make</label>
          <div class="form-control-static">{{ vm.contract.make || '&nbsp;' }}</div>
        </div>
        <div class="col">
          <label class="control-label">Model</label>
          <div class="form-control-static">{{ vm.contract.model || '&nbsp;' }}</div>
        </div>
      </div>

      <div class="form-group row">
        <div class="col">
          <label class="control-label">Contract Number</label>
          <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.contract_number }"
          ng-model="vm.contract.contract_number" />
          <div class="invalid-feedback">
            Please enter a number.
          </div>
        </div>
        <div class="col">
          <label class="control-label">Stock Number</label>
          <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.stock_number }" ng-model="vm.contract.stock_number" />
          <div class="invalid-feedback">
            Please enter a number.
          </div>
        </div>
      </div>

      <div class="form-group row">
        <div class="col">
          <label>Purchase Date</label>
          <datepicker date-format="yyyy-MM-dd">
            <input
              class="form-control"
              ng-class="{ 'is-invalid': vm.contract.errors.purchased_on }"
              type="date" ng-model="vm.contract.purchased_on"
              />
          </datepicker>
        </div>

        <div class="col">
          <label>Miles</label>
          <input type="number" min="0" class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.odometer }" ng-model="vm.contract.odometer" />
        </div>
      </div>

      <div class="form-group row">
        <div class="col">
          <label>Selling Price</label>
          <input class="form-control" ng-model="vm.contract.price" ng-currency />
        </div>
        <div class="col">
          <label>Lien Holder</label>
          <input class="form-control" ng-model="vm.contract.lien_holder" />
        </div>
      </div>

      <hr />

      <div class="form-group">
        <div class="row">
          <div class="col pr-1">
            <label>First Name</label>
            <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.first_name }" ng-model="vm.contract.first_name"/>
          </div>
          <div class="col pl-1">
            <label>Last Name</label>
            <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.last_name }" ng-model="vm.contract.last_name"/>
          </div>
        </div>
      </div>


      <div class="form-group">
        <label>Address</label>
        <input class="form-control mb-1" ng-class="{ 'is-invalid': vm.contract.errors.address1 }" ng-model="vm.contract.address1"/>
        <input class="form-control mb-1" ng-class="{ 'is-invalid': vm.contract.errors.address2 }" ng-model="vm.contract.address2"/>
        <input class="form-control mb-1" ng-class="{ 'is-invalid': vm.contract.errors.address3 }" ng-model="vm.contract.address3"/>
        <div class="row">
          <div class="col pr-1">
            <label>City</label>
            <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.city }" ng-model="vm.contract.city"/>
          </div>
          <div class="col px-0">
            <label>State</label>
            <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.state }" ng-model="vm.contract.state"/>
          </div>
          <div class="col pl-1">
            <label>Zip</label>
            <input class="form-control" ng-class="{ 'is-invalid': vm.contract.errors.zip }" ng-model="vm.contract.zip"/>
          </div>
        </div>
        <div class="invalid-feedback">
          Please enter address info.
        </div>
      </div>

      <div class="form-group row">
        <div class="col">
          <label>Mobile Number</label>
          <input class="form-control" ng-model="vm.contract.mobile_number" />
        </div>

        <div class="col">
          <label>Home Number</label>
          <input class="form-control" ng-model="vm.contract.home_number" />
        </div>
      </div>

      <div class="form-group row">
        <div class="col">
          <label>Work Number</label>
          <input class="form-control" ng-model="vm.contract.work_number" />
        </div>
        <div class="col">
          <label>Email</label>
          <input class="form-control" ng-model="vm.contract.email" />
        </div>
      </div>
    </div>
    <div class="col-4" style='background-color:#BA2026; color: white; max-height: 300px;'>
      <div class="form-group row">
        <div class="col">
          <label>Contract Number</label>
          <p ng-bind="vm.contract.contract_number"></p>
        </div>
        <div class="col">
          <label>Purchased On</label>
          <p ng-bind="vm.contract.purchased_on"></p>
        </div>
      </div>

      <div class="form-group">
        <label>VIN</label>
        <p ng-bind="vm.contract.vin"></p>
      </div>

      <div class="form-group row">
        <div class="col">
          <label class="control-label">Year</label>
          <div class="form-control-static">{{ vm.contract.year }}</div>
        </div>
        <div class="col">
          <label class="control-label">Make</label>
          <div class="form-control-static">{{ vm.contract.make || '&nbsp;' }}</div>
        </div>
        <div class="col">
          <label class="control-label">Model</label>
          <div class="form-control-static">{{ vm.contract.model || '&nbsp;' }}</div>
        </div>
      </div>
    </div>
  </div>

  <hr />

  <div class="form-group">
    <div class="float-right">
      <button type="submit" class="btn btn-primary">Save</button>
      <button type="button" ng-click="vm.cancel()" class="btn btn-link">Cancel</button>
    </div>
  </div>
</form>
